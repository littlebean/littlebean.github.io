<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>对虚函数的一些理解 | 聆听</title>
  <meta name="author" content="聆听">
  
  <meta name="description" content="聆听的博客">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <meta property="og:title" content="对虚函数的一些理解"/>
  <meta property="og:site_name" content="聆听"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="聆听" type="application/atom+xml">

  <link rel="stylesheet" href="/css/bootstrap.min.css"> 
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-41590217-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


</head>


<body>
<div class="container">
    <div class="row">
        <div class="header">
    <ul class="nav nav-pills pull-right">
        <li>
            <div>
                <ol class="breadcrumb">
                    
                    <li><a href="/">Home</a></li>
                    
                    <li><a href="/archives">Archives</a></li>
                    
                    <li><a href="/about">About</a></li>
                    
                    <li> <a href="/atom.xml">Rss</a></li>
                </ol>
            </div>
        </li>
    </ul>

    <h2>
        <a href="/">聆听</a> 
    </h2>
    <h5 class="text-muted"> 水滴石穿  </h5>
</div>

    </div>

    <hr> 

    <div class="row">
         <!--Body content-->
         <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <div class="header">
      
  
    <h3 class="title">对虚函数的一些理解
        <small>
            <time datetime="2014-03-12T08:08:00.000Z">3月 12 2014</time>
        </small>
    </h3>
  


    </div>

    <div class="entry">
      
        <h2 id="-">引言</h2>
<p>日子过的真快，研究生念的都还没有什么感觉就要找实习了，学校来了第一个找实习的公司---华为。投了中央研究院的一个C++研发岗，今天面试问了一些项目什么的，然后问道C++和JAVA的一些区别，就说了几个比较浅的区别，什么JAVA是纯面向对象的，C++是半结构化半面向对象的，支持多继承的一门语言什么的，面我的那位帅哥感觉还不足提示了一下在面向对象的3个特性（封装，继承，多态）来说一下，然后我就回答了最主要的区别是在多态的实现机制上的不同，JAVA是靠重载，C++是靠虚函数来实现的，然后就紧接着问，虚函数的怎么实现多态的，当时没有说用虚函数表什么的，就大概说了一下是用基类的指针绑定派生类的对象的，然后调用派生类中对基类虚函数实现的调用，感觉回答的好不专业，然后他就说用虚函数表就能简单的说明，下面我来总结一下虚函数和虚函数表的一些东西。
<a id="more"></a></p>
<h2 id="-">虚函数</h2>
<h3 id="-">什么是虚函数</h3>
<p>在某基类中声明为<code>virtual</code>并在一个或多个派生类中被重新定义的成员函数，C++通过它实现多态性，通过指向派生类的基类指针，访问派生类中同名覆盖成员函数。
基类的类定义中定义虚函数的一般形式：</p>
<figure class="highlight C++"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span>基类名{</span>
	virtual 返回值类型 将要在派生类中重载的函数名（参数列表）;
}；
</pre></td></tr></table></figure>

<h3 id="-">虚函数的作用</h3>
<p>虚函数的作用是实现<strong>动态联编</strong>，也就是在程序的运行阶段动态地选择合适的成员函数，在定义了虚函数后，可以在基类的派生类中对虚函数重新定义，在派生类中重新定义的函数应与虚函数具有相同的形参个数和形参类型。以实现统一的接口，不同定义过程。如果在派生类中没有对虚函数重新定义，则它继承其基类的虚函数。</p>
<h3 id="-">纯虚函数和抽象类</h3>
<p>可以把此函数（方法）设为virtual 函数名（参数列表）= 0 我们把这样的函数（方法）称为纯虚函数。如果一个类包含了纯虚函数，称此类为抽象类。<strong>抽象类不能直接实例化对象</strong>。</p>
<h3 id="-">例子</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="code"><pre>
<span class="preprocessor">#include&lt;iostream&gt;</span>
<span class="keyword">using</span> namespace std;
class A{
	<span class="keyword">public</span>:
		<span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">display</span>(){
			cout&lt;&lt;<span class="string">"this is A"</span>&lt;&lt;endl;
		} 
		
};

class B:<span class="keyword">public</span> A{
	
	<span class="keyword">public</span>:
		<span class="keyword">void</span> <span class="title">display</span>(){
			cout&lt;&lt;<span class="string">"this is B"</span>&lt;&lt;endl;
		}

};

<span class="keyword">int</span> main(){
	A *a = <span class="keyword">new</span> A();
	a-&gt;display();
	a = <span class="keyword">new</span> B();
	a-&gt;display();
	
	<span class="keyword">return</span> <span class="number">0</span>;
}

output:
<span class="keyword">this</span> <span class="keyword">is</span> A
<span class="keyword">this</span> <span class="keyword">is</span> B
请按任意键继续. . .
</pre></td></tr></table></figure>

<p>从上面的例子可以看到开始<code>a</code>指向<code>A</code>的对象，当<code>a-&gt;display()</code>时，调用的是A自己的<code>display()</code>,然后将<code>B</code>的对象绑定到<code>a</code>上，则再次调用的时候就执行了<code>B</code>的<code>display()</code>方法。这样也实现了<code>display()</code>方法的推迟绑定，这样也使得编程更加灵活。</p>
<h2 id="-">虚函数表</h2>
<h3 id="-">什么是虚函数表</h3>
<p>对C++ 了解的人都应该知道虚函数（Virtual Function）是通过一张虚函数表（Virtual Table）来实现的。简称为V-Table。在这个表中，主是要一个类的虚函数的地址表，这张表解决了继承、覆盖的问题，保证其容真实反应实际的函数。这样，在有虚函数的类的实例中这个表被分配在了这个实例的内存中，所以，当我们用父类的指针来操作一个子类的时候，这张虚函数表就显得由为重要了，它就像一个地图一样，指明了实际所应该调用的函数。
这里我们着重看一下这张虚函数表。C++的编译器应该是保证虚函数表的指针存在于对象实例中最前面的位置（这是为了保证取到虚函数表的有最高的性能——如果有多层继承或是多重继承的情况下）。 这意味着我们通过对象实例的地址得到这张虚函数表，然后就可以遍历其中函数指针，并调用相应的函数。</p>
<p><img src="http://liitlebean.qiniudn.com/2014/03/12/vTable.jpg" alt="虚函数表与对象的关系"></p>
<h3 id="-">例子</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="code"><pre>
<span class="preprocessor">#include&lt;iostream&gt;</span>
<span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;

<span class="keyword">typedef</span> <span class="keyword">void</span>(*Fun)(<span class="keyword">void</span>);

<span class="keyword">class</span> A{
	<span class="keyword">public</span>:
		<span class="keyword">virtual</span> <span class="keyword">void</span> m1(){
			<span class="built_in">cout</span>&lt;&lt;<span class="string">"m1"</span>&lt;&lt;endl;
		}
		<span class="keyword">virtual</span> <span class="keyword">void</span> m2(){
			<span class="built_in">cout</span>&lt;&lt;<span class="string">"m2"</span>&lt;&lt;endl;	
		}
		
};


<span class="keyword">int</span> main(){	
	Fun pfun;
	A a;
	
	<span class="built_in">cout</span>&lt;&lt;<span class="string">"虚函数表地址："</span>&lt;&lt;(<span class="keyword">int</span>*)&a&lt;&lt;endl;
	<span class="built_in">cout</span>&lt;&lt;<span class="string">"虚函数表第一个虚函数的地址："</span>&lt;&lt;(<span class="keyword">int</span>*)*(<span class="keyword">int</span>*)&a&lt;&lt;endl;
	
	pfun = (Fun)*((<span class="keyword">int</span>*)*(<span class="keyword">int</span>*)&a); 
	pfun();<span class="comment">//调用第一个虚函数 </span>
	pfun = (Fun)*(<span class="number">1</span>+(<span class="keyword">int</span>*)*(<span class="keyword">int</span>*)&a);
	pfun();<span class="comment">//调用第二个虚函数 </span>
	<span class="keyword">return</span> <span class="number">0</span>;
}

output:
虚函数表地址：<span class="number">0x22ff20</span>
虚函数表第一个虚函数的地址：<span class="number">0x443fe0</span>
m1
m2
</pre></td></tr></table></figure>

<p>参考：</br>
<a herf="http://baike.baidu.com/link?url=3ahXhj5Xfiqgva5yftcsV-uHkzCdcQmBFDFV6stKVD5uOpTdNN490y4JqxsB3oWK"><a href="http://baike.baidu.com/link?url=3ahXhj5Xfiqgva5yftcsV-uHkzCdcQmBFDFV6stKVD5uOpTdNN490y4JqxsB3oWK">http://baike.baidu.com/link?url=3ahXhj5Xfiqgva5yftcsV-uHkzCdcQmBFDFV6stKVD5uOpTdNN490y4JqxsB3oWK</a></a></br>
<a href="http://blog.csdn.net/haoel/article/details/1948051/" target="_blank"><a href="http://blog.csdn.net/haoel/article/details/1948051/">http://blog.csdn.net/haoel/article/details/1948051/</a></a></p>

      
    </div>

	

	<hr/>
  <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
  
<section id="comment">
<!-- Duoshuo Comment BEGIN -->
  <div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"xuxiaolong"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- Duoshuo Comment END -->
</section>

  </div>
</article>




        <!--Sidebar content-->
        <div class="sidebar">
        
<div class="container">


	<div class="col-xs-12 col-sm-6 col-md-3">
  	    
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2014/03/16/stl概述/">STL概述</a>
      </li>
    
      <li>
        <a href="/2014/03/12/对虚函数的一些理解/">对虚函数的一些理解</a>
      </li>
    
      <li>
        <a href="/2014/03/06/stl实现的底层数据结构有哪些？/">STL实现的底层数据结构有哪些？</a>
      </li>
    
      <li>
        <a href="/2014/03/04/引用和指针的区别/">引用和指针的区别</a>
      </li>
    
      <li>
        <a href="/2014/02/27/b树/">B树</a>
      </li>
    
      <li>
        <a href="/2014/02/27/数据库的索引/">数据库的索引</a>
      </li>
    
      <li>
        <a href="/2014/02/23/c和c++头文件一些问题/">C和C++头文件一些问题</a>
      </li>
    
      <li>
        <a href="/2014/01/31/goto-2014-from-2013/">Goto 2014 From 2013</a>
      </li>
    
      <li>
        <a href="/2013/08/19/win7远程连接全屏/">Win7远程连接全屏</a>
      </li>
    
  </ul>
</div>


  	</div>

	<div class="col-xs-12 col-sm-6 col-md-3">
  	    <div class="widget tag">
	<h3 class="title">Link</h3>
	<ul class="entry">
		<li><a href="http://cih.so" target="_blank" title="MaHuipei">Kingx's Blog</a></li>
      	<li><a href="http://wtz123.github.io" target="_blank" title="WangTianzhi">wtz's Blog</a></li>
      	<li><a href="http://xidianpanpei.github.io" target="_blank" title="PanPei">PanPei's Blog</a></li>
      	<li><a href="http://yanhoulei.cn/" target="_blank">yanhoulei's Blog</a></li>
		<li><a href="http://www.searchtb.com/" target="_blank">搜索技术博客－淘宝</a></li>
		<li><a href="http://www.spinics.net/linux/" target="_blank">Rick's Linux Resources</a></li>
		
	</ul>
</div>

  	</div>

	<div class="col-xs-12 col-sm-6 col-md-3">
  	    
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/C/C++/">C/C++</a><small>3</small></li>
  
    <li><a href="/categories/STL/">STL</a><small>2</small></li>
  
    <li><a href="/categories/总结/">总结</a><small>1</small></li>
  
    <li><a href="/categories/数据库/">数据库</a><small>1</small></li>
  
    <li><a href="/categories/STL/数据结构/">数据结构</a><small>1</small></li>
  
    <li><a href="/categories/数据结构/">数据结构</a><small>1</small></li>
  
    <li><a href="/categories/电脑常识/">电脑常识</a><small>1</small></li>
  
  </ul>
</div>


  	</div>

	<div class="col-xs-12 col-sm-6 col-md-3">
  	    
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/C/C++/">C/C++</a><small>1</small></li>
  
    <li><a href="/tags/日常问题/">日常问题</a><small>1</small></li>
  
    <li><a href="/tags/生活点滴/">生活点滴</a><small>1</small></li>
  
    <li><a href="/tags/编程技术/">编程技术</a><small>6</small></li>
  
  </ul>
</div>


  	</div>


</div>

        </div>
    </div>

    <div class="footer">
        <div class="alignleft">
  
  &copy; 2014 聆听
  
</div>
<div class="clearfix"></div>

    </div>

</div>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
    (function($){
        $('.fancybox').fancybox();
    })(jQuery);
</script>




</body>
</html>
